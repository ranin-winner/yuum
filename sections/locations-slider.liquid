{% comment %}
  Locations Slider Section
  - Заголовок/підзаголовок/тексти як у твоїй product секції
  - Слайдер на Swiper
  - Картки беруться з blocks і рендеряться через snippets/locations-card.liquid
{% endcomment %}

{% render 'entry' with '@/styles/sections/location-section.scss' %}

{% assign sectionText1 = section.settings.section_text_1 %}
{% assign sectionText2 = section.settings.section_text_2 %}
{% assign sectionSubtitle = section.settings.subtitle %}
{% assign sectionBadgeText = section.settings.section_badge_text %}
{% assign sectionButtonText = section.settings.section_button_text %}

<section
  id="locationsSection-{{ section.id }}"
  class="location-section mx-auto palette-{{ section.settings.color_scheme }}"
>
  <div class="container">
    <div class="location-section__header grid md:grid-cols-2 grid-cols-1 gap-[24px] mb-[50px]">
      {% if section.settings.title != blank %}
        <div class="location-section__header--title">
          <h2 class="location-section__title heading-3">
            {{ section.settings.title | default: "Our locations" }}
          </h2>
          {% if sectionSubtitle != blank %}
            <p class="location-section__subtitle">{{ sectionSubtitle }}</p>
          {% endif %}
        </div>
      {% endif %}

      <div class="location-section__header--text-and-btn">
        {% if sectionText1 != blank %}
          <div class="text">{{ sectionText1 }}</div>
        {% endif %}

        {% if sectionBadgeText != blank %}
          <div class="badge flex items-center gap-[15px] mt-[32px] mb-[12px]">
            {{ section.settings.section_badge_icon }} {{ sectionBadgeText }}
          </div>
        {% endif %}

        {% if sectionText2 != blank %}
          <div class="text">{{ sectionText2 }}</div>
        {% endif %}

        {% if sectionButtonText != blank %}
          <a href="{{ section.settings.section_button_link }}" class="btn btn-light">{{ sectionButtonText }}</a>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="slider-wrapper relative">
    <div class="swiper-box">
        <div class="swiper-button-next md:block">
        {% render 'next-arrow' %}
        </div>
        <div class="swiper-button-prev md:block">
        {% render 'prev-arrow' %}
        </div>

        <div class=" md:ml-[40px]">
        <div id="swiper-container-{{ section.id }}" class="swiper-container pb-0 ">
            <div class="swiper-wrapper">
            {% for block in section.blocks %}
                <div class="swiper-slide" {{ block.shopify_attributes }}>
                {% render 'locations-card',
                    image: block.settings.image,
                    title: block.settings.title,
                    subtitle: block.settings.subtitle,
                    address: block.settings.address,
                    city: block.settings.city,
                    hours: block.settings.hours,
                    phone: block.settings.phone,
                    badge: block.settings.badge,
                    link_page: block.settings.link_page,
                    link_url: block.settings.link_url,
                    link_label: block.settings.link_label
                %}
                </div>
            {% endfor %}
            </div>
        </div>
        {% comment %} <div class="swiper-pagination h-[2px] bg-black/10 w-full"></div> {% endcomment %}
        </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sectionSel   = '#locationsSection-{{ section.id }}'
    const containerSel = '#swiper-container-{{ section.id }}'

    const originalSlideCount = document.querySelectorAll(
      `${containerSel} .swiper-wrapper > .swiper-slide`
    ).length

    const swiper = new Swiper(containerSel, {
      loop: originalSlideCount > 1,
      slidesPerView: 3.2,
      spaceBetween: 40,
      navigation: {
        nextEl: `${sectionSel} .swiper-button-next`,
        prevEl: `${sectionSel} .swiper-button-prev`,
        enabled: true
      },
    //   pagination: {
    //     el: `${sectionSel} .swiper-pagination`,
    //     type: 'progressbar',
    //     enabled: true
    //   },
      breakpoints: {
        0:   { slidesPerView: 1.2, spaceBetween: 16, centeredSlides: true, autoHeight: true, navigation: { enabled: false } },
        640: { slidesPerView: 1.8, autoHeight: true },
        768: { slidesPerView: 2.5 },
        1024:{ slidesPerView: 3.5 },
        1280:{ slidesPerView: 3.3 }
      }
    })

    // За бажанням: ховаємо навігацію на десктопі, якщо слайдів менше 5
    const nextBtn = document.querySelector(`${sectionSel} .swiper-button-next`)
    const prevBtn = document.querySelector(`${sectionSel} .swiper-button-prev`)
    function updateNav() {
      const isDesktop = window.matchMedia('(min-width: 1024px)').matches
      const show = isDesktop && originalSlideCount >= 5
      if (nextBtn) nextBtn.style.display = show ? '' : 'none'
      if (prevBtn) prevBtn.style.display = show ? '' : 'none'
      if (swiper.navigation) {
        if (show) swiper.navigation.enable()
        else swiper.navigation.disable()
      }
    }
    swiper.on('resize', updateNav)
    swiper.on('breakpoint', updateNav)
    updateNav()
  })
</script>

{% schema %}
{
  "name": "Locations slider",
  "tag": "section",
  "class": "locations-slider",
  "settings": [
    { "type": "richtext", "id": "title", "label": "Section Title" },
    { "type": "richtext", "id": "subtitle", "label": "Section subtitle" },
    { "type": "richtext", "id": "section_text_1", "label": "Section text 1" },
    { "type": "textarea", "id": "section_badge_icon", "label": "Paste icon for badge" },
    { "type": "text", "id": "section_badge_text", "label": "Section badge text" },
    { "type": "richtext", "id": "section_text_2", "label": "Section text 2" },
    { "type": "text", "id": "section_button_text", "label": "Button text", "default": "All locations" },
    { "type": "url", "id": "section_button_link", "label": "Button link" },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "default",
      "options": [
        { "value": "default", "label": "Default" },
        { "value": "inverse", "label": "Inverse" }
      ]
    }
  ],
  "blocks": [
    {
      "type": "location",
      "name": "Location",
      "limit": 24,
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "title", "label": "Title", "default": "Kyiv, Downtown" },
        { "type": "text", "id": "subtitle", "label": "Subtitle (optional)" },
        { "type": "text", "id": "hours", "label": "Working hours (optional)" },
        { "type": "text", "id": "phone", "label": "Phone (optional)" },
        { "type": "text", "id": "badge", "label": "Badge (optional)", "info": "Напр. New, Flagship" },
        { "type": "page", "id": "link_page", "label": "Location page (recommended)" },
        { "type": "url", "id": "link_url", "label": "Custom URL (fallback)" },
        { "type": "text", "id": "link_label", "label": "CTA label (optional)", "default": "More info" }
      ]
    }
  ],
  "presets": [
    { "name": "Locations slider" }
  ]
}
{% endschema %}
