{"version":3,"file":"main-product-DyTyat1O.js","sources":["../frontend/scripts/sections/main-product.js"],"sourcesContent":["document.addEventListener('alpine:init', () => {\r\n  Alpine.data('productCard', (sectionId, product) => ({\r\n    sectionId,\r\n    mainProduct: product || {},\r\n    mode: null, // one-time | subscribe\r\n    showSubscription: false,\r\n    discount: 0,\r\n    regularPrice: 0,\r\n    discountedPrice: 0,\r\n    actualPrice: 0,\r\n    isLoading: false,\r\n    sellingPlanGroups: undefined,\r\n    sellingPlanId: null,\r\n    sellingPlansMap: [],\r\n    selectedPlanId: null,\r\n    selectedPlan: {},\r\n    selectedProduct: null,\r\n    quantity: 1,\r\n\r\n    init() {\r\n      if (!this.mainProduct || !this.mainProduct.price) {\r\n        console.error('mainProduct or its price is missing');\r\n        return;\r\n      }\r\n\r\n      const tabElement = this.$el.querySelector('.tabs-product-selector');\r\n      this.sellingPlanGroups = this.mainProduct.selling_plan_groups;\r\n\r\n      if (this.sellingPlanGroups?.length > 0) {\r\n        const firstGroup = this.sellingPlanGroups[0];\r\n        if (firstGroup?.selling_plans?.length > 0) {\r\n          this.sellingPlanId = firstGroup.app_id;\r\n          this.sellingPlansMap = firstGroup.selling_plans;\r\n          this.selectedPlanId = this.sellingPlansMap[0].id;\r\n          this.selectedPlan = this.sellingPlansMap.find((plan) => plan.id === this.selectedPlanId);\r\n          this.discount = this.selectedPlan.price_adjustments[0].value;\r\n        }\r\n      }\r\n      // console.log('Selling plan:', this.mainProduct);\r\n      // console.log('Selling plan:', this.sellingPlanGroups[0]);\r\n      // console.log('Selling plan:', this.sellingPlansMap);\r\n      // console.log('Selling plan:', this.selectedPlan);\r\n\r\n      if (tabElement) {\r\n        this.tab1Selected = JSON.parse(tabElement.getAttribute('data-tab1-selected'));\r\n        this.tab2Selected = JSON.parse(tabElement.getAttribute('data-tab2-selected'));\r\n        this.mode = tabElement.getAttribute('data-tab-selected');\r\n      }\r\n\r\n      this.showSubscription = this.mode === 'subscribe';\r\n      this.updateActualPrice();\r\n    },\r\n\r\n    initNewProduct(product) {\r\n      this.mainProduct = product;\r\n      // this.updateActualPrice();\r\n      this.$nextTick(() => {\r\n        console.log('Product initialized:', this.mainProduct);\r\n        this.updateActualPrice();\r\n      });\r\n    },\r\n\r\n    formatPrice(price) {\r\n      const formattedPrice = price.toFixed(2);\r\n      return `$${formattedPrice}`;\r\n    },\r\n\r\n    updateActualPrice() {\r\n      this.regularPrice = this.mainProduct.price / 100;\r\n      if (this.mode === 'subscribe' && this.discount > 0) {\r\n        this.discountedPrice = this.regularPrice - (this.regularPrice * this.discount / 100);\r\n        this.actualPrice = this.discountedPrice;\r\n        // console.log('this.actualPrice:', this.actualPrice);\r\n      } else {\r\n        this.actualPrice = this.regularPrice;\r\n      }\r\n    },\r\n\r\n    switchTab(tab) {\r\n      this.mode = tab;\r\n      this.showSubscription = (tab === 'subscribe');\r\n      this.updateActualPrice();\r\n    },\r\n\r\n    addToCartPDP(quantity) {\r\n      const variantId = this.$el.getAttribute('data-first-variant');\r\n      const product = {\r\n        variantId,\r\n        quantity,\r\n        sellingPlanId: this.selectedPlanId,\r\n        properties: {},\r\n      };\r\n      Alpine.store('cart').addToCart(product);\r\n      this.quantity = 1;\r\n    },\r\n\r\n    loadProduct(productHandle) {\r\n      const url = `/products/${productHandle}?sections=${this.sectionId}`;\r\n      const productUrl = `/products/${productHandle}.js`\r\n\r\n      fetch(url)\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error('Network response was not ok');\r\n          }\r\n          console.log('Product details:', response);\r\n          return response.json();\r\n        })\r\n        .then((product) => {\r\n          if (!product[this.sectionId]) {\r\n            console.error('Product section not found');\r\n            return;\r\n          }\r\n          const container = document.createElement('div');\r\n          container.innerHTML = product[this.sectionId];\r\n          const productDetails = container.querySelector('#MainProduct-' + this.sectionId);\r\n          if (this.$refs.productCardRef) {\r\n            this.$refs.productCardRef.replaceWith(productDetails);\r\n          } else {\r\n            console.error('Reference to productCardRef not found');\r\n          }\r\n          return fetch(productUrl);\r\n        })\r\n        .then((response) => {\r\n          if (!response.ok) {\r\n            throw new Error('Failed to fetch product data');\r\n          }\r\n          return response.json();\r\n        })\r\n        .then((productData) => {\r\n          // this.mainProduct = productData;\r\n          // this.init();\r\n          // this.updateActualPrice();\r\n          this.initNewProduct(productData);\r\n          window.history.pushState({ urlPath: productHandle }, '', productHandle);\r\n        })\r\n        .catch((error) => {\r\n          console.error('Error loading product:', error);\r\n        });\r\n      }\r\n  }));\r\n});\r\n"],"names":["sectionId","product","_a","_b","tabElement","firstGroup","plan","price","tab","quantity","productHandle","url","productUrl","response","container","productDetails","productData","error"],"mappings":"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"}