document.addEventListener("alpine:init",()=>{Alpine.data("productCard",(c,a)=>({sectionId:c,mainProduct:a||{},mode:"one-time",showSubscription:!1,discount:0,regularPrice:0,discountedPrice:0,actualPrice:0,sellingPlanGroups:void 0,sellingPlanId:null,sellingPlansMap:[],selectedPlanId:null,selectedPlan:{},isLoading:!1,sliderLoading:!1,swiper:null,init(){try{this.bootstrapModeFromDOM()}catch{}try{this.updateActualPrice()}catch{}this.$nextTick(()=>this.initProductSwiper())},destroy(){this.destroyProductSwiper()},$q(t){return this.$root?this.$root.querySelector(t):null},getSliderWrapper(){return this.$q('[data-role="main-product-slider"]')},initProductSwiper(){try{this.destroyProductSwiper();const t=this.getSliderWrapper();if(!t)return;if(!window.Swiper){console.error("[productCard] Swiper is not available");return}const i=t.querySelector('[data-el="container"]'),r=t.querySelector('[data-el="next"]'),e=t.querySelector('[data-el="prev"]'),s=t.querySelector('[data-el="pagination"]');if(!i)return;i.classList.contains("swiper-container")&&i.classList.add("swiper"),this.swiper=new window.Swiper(i,{slidesPerView:1,spaceBetween:0,loop:!1,watchOverflow:!0,navigation:{nextEl:r,prevEl:e},pagination:{el:s,clickable:!0},observer:!0,observeParents:!0})}catch(t){console.error("[productCard] initProductSwiper failed:",t)}},destroyProductSwiper(){try{this.swiper&&typeof this.swiper.destroy=="function"&&this.swiper.destroy(!0,!0)}finally{this.swiper=null}},loadProduct(t){if(!t)return;const i=`/products/${t}?sections=${this.sectionId}`,r=`/products/${t}.js`;this.isLoading=!0,fetch(i).then(e=>{if(!e.ok)throw new Error("[productCard] Section fetch failed");return e.json()}).then(e=>{const s=e?.[this.sectionId];if(!s)throw new Error("[productCard] Section HTML not found");const o=document.createElement("div");o.innerHTML=s;const n=o.querySelector("#MainProduct-"+this.sectionId);return n&&this.$refs.productCardRef&&(this.$refs.productCardRef.replaceWith(n),this.$root=n,this.$nextTick(()=>this.initProductSwiper())),fetch(r)}).then(e=>{if(!e?.ok)throw new Error("[productCard] Product JSON fetch failed");return e.json()}).then(e=>{this.initNewProduct(e),window.history.pushState({urlPath:t},"",t)}).catch(e=>console.error(e)).finally(()=>{this.isLoading=!1})},initNewProduct(t){!t||!t.id||(this.mainProduct=t,this.updateActualPrice(),this.$nextTick(()=>this.initProductSwiper()))},updateActualPrice(){const t=this.getSelectedVariant();if(t)if(this.regularPrice=Number(t.compare_at_price||t.price||0),this.discountedPrice=Number(t.price||0),this.showSubscription&&this.selectedPlan&&this.selectedPlan.discount){const i=Number(this.selectedPlan.discount)||0;this.actualPrice=Math.round(this.discountedPrice*(1-i/100))}else this.actualPrice=this.discountedPrice},getSelectedVariant(){const t=this.mainProduct?.variants||[];if(!t.length)return null;const i=document.querySelector('[name="id"][type="hidden"], [name="id"][type="radio"]:checked');if(i&&i.value){const e=t.find(s=>String(s.id)===String(i.value));if(e)return e}return t.find(e=>e.available)||t[0]},onVariantChange(){try{this.updateActualPrice()}catch{}},bootstrapModeFromDOM(){const t=document.querySelector("[data-subscription-tabs]");if(!t){this.mode="one-time",this.showSubscription=!1;return}const i=t.getAttribute("data-tab1-selected"),r=t.getAttribute("data-tab2-selected"),e=t.getAttribute("data-tab-selected");i!=null&&(this.tab1Selected=JSON.parse(i)),r!=null&&(this.tab2Selected=JSON.parse(r)),e&&(this.mode=e),this.showSubscription=this.mode==="subscribe"},selectPlan(t){this.selectedPlanId=t||null,this.selectedPlan=(this.sellingPlansMap||[]).find(i=>String(i.id)===String(t))||{},this.showSubscription=!!this.selectedPlanId,this.updateActualPrice()},toggleSubscription(t){typeof t=="boolean"?this.showSubscription=t:this.showSubscription=!this.showSubscription,this.updateActualPrice()}}))});
//# sourceMappingURL=main-product-D1X0YldZ.js.map
