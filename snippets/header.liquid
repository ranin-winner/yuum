{% assign settingsHeaderBg = settings.header_bg %}

{% capture accountIcon %}
  <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_7791_25650)">
      <path d="M7.03293 26.0002C7.00983 26.0002 7.00983 26.0002 6.98674 26.0002C6.68651 25.9771 6.47866 25.7231 6.50175 25.4459C6.80198 21.0349 10.959 17.5938 15.9475 17.5938C20.9359 17.5938 25.093 21.0349 25.3932 25.4228C25.4163 25.7231 25.1854 25.954 24.9082 25.9771C24.608 26.0002 24.377 25.7693 24.3539 25.4921C24.0768 21.6353 20.3817 18.633 15.9475 18.633C11.4902 18.633 7.79505 21.6584 7.54101 25.5152C7.51792 25.7924 7.28697 26.0002 7.03293 26.0002Z" fill="#474747"/>
      <path d="M15.9472 16.5312C13.0373 16.5312 10.6816 14.1755 10.6816 11.2656C10.6816 8.35566 13.0373 6 15.9472 6C18.8572 6 21.2128 8.35566 21.2128 11.2656C21.2128 14.1755 18.8572 16.5312 15.9472 16.5312ZM15.9472 7.06236C13.6378 7.06236 11.744 8.95612 11.744 11.2656C11.744 13.5751 13.6378 15.4688 15.9472 15.4688C18.2567 15.4688 20.1505 13.5751 20.1505 11.2656C20.1505 8.95612 18.2567 7.06236 15.9472 7.06236Z" fill="#474747"/>
    </g>
    <defs>
      <clipPath id="clip0_7791_25650">
        <rect width="20" height="20" fill="white" transform="translate(6 6)"/>
      </clipPath>
    </defs>
  </svg>
{% endcapture %}

{% capture searchIcon %}
  <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g clip-path="url(#clip0_8267_7936)">
      <path d="M25.3891 24.603L21.0487 20.2626C22.3809 18.7435 23.1159 16.8214 23.1159 14.7821C23.1159 12.556 22.2489 10.4635 20.675 8.88959C19.1011 7.3157 17.0086 6.44873 14.7826 6.44873C12.5565 6.44873 10.464 7.3157 8.89008 8.88959C7.31619 10.4635 6.44922 12.556 6.44922 14.7821C6.44922 17.0081 7.31619 19.1006 8.89008 20.6745C10.464 22.2484 12.5565 23.1154 14.7826 23.1154C16.8218 23.1154 18.744 22.3804 20.2631 21.0482L24.6035 25.3886C24.712 25.4971 24.8542 25.5514 24.9963 25.5514C25.1385 25.5514 25.2806 25.4971 25.3891 25.3886C25.6061 25.1716 25.6061 24.82 25.3891 24.603ZM9.67567 19.8889C8.31174 18.5247 7.56033 16.711 7.56033 14.7821C7.56033 12.8531 8.31174 11.0394 9.67567 9.67518C11.0399 8.31125 12.8536 7.55984 14.7826 7.55984C16.7115 7.55984 18.5252 8.31125 19.8894 9.67518C21.2534 11.0394 22.0048 12.8531 22.0048 14.7821C22.0048 16.711 21.2534 18.5247 19.8894 19.8889C18.5252 21.2529 16.7115 22.0043 14.7826 22.0043C12.8536 22.0043 11.0399 21.2529 9.67567 19.8889Z" fill="currentColor"/>
    </g>
    <defs>
      <clipPath id="clip0_8267_7936">
        <rect width="20" height="20" fill="white" transform="translate(6 6)"/>
      </clipPath>
    </defs>
  </svg>
{% endcapture %}

{% if settings.show_promo %}
  <div class="b-header__promo relative w-full overflow-hidden bg-black py-4 text-center text-white-content tracking-[0.1rem]">
    {% assign has_list = settings.promo_text contains '<li' %}
    {% if has_list %}
      <ul class="b-promo-hslider js-promo-hslider relative h-[1.6em]">
        {{ settings.promo_text }}
      </ul>
    {% else %}
      <div class="b-header__promo-single">
        {% if settings.show_promo_link != blank %}
          <a href="{{ settings.show_promo_link }}" target="_blank" class="inline-flex items-center gap-2">
            {{ settings.promo_text }}
            {% render 'icon-arrow-right' %}
          </a>
        {% else %}
          {{ settings.promo_text }}
        {% endif %}
      </div>
    {% endif %}
  </div>
  <style>

    /* –ù–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ header fixed —ñ –ø—Ä–æ–∑–æ—Ä–∏–π */
    .template-index .b-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: transparent;
      border-bottom: none;
      z-index: 1000;
      border-bottom: 1px solid #FFFFFF;
    }

    /* –ö–æ–ª–∏ —Å–∫—Ä–æ–ª–∏–º–æ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π - header —Å—Ç–∞—î –∑–≤–∏—á–∞–π–Ω–∏–º */
    .template-index .b-header.m-sticky {
      position: fixed;
      background: #E7E7E7;
      border-bottom: 1px solid #ADAEB0;
    }

    /* Hero –±–∞–Ω–Ω–µ—Ä –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –≤—ñ–¥ —Å–∞–º–æ–≥–æ –≤–µ—Ä—Ö—É */
    .template-index .b-hero-banner {
      margin-top: 0;
      position: relative;
      z-index: 1;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî –æ–¥–Ω–∞ –ª—ñ–Ω—ñ—è –≤–∏—Å–æ—Ç–∏ */
    .b-promo-hslider {
      list-style: none;
      margin: 0;
      padding: 0;
      position: relative;
      height: 1.6em;
      line-height: 1.6em;
      overflow: hidden;
      text-align: center;
    }

    /* –ë–∞–∑–æ–≤–∏–π —Å—Ç–∞–Ω: –µ–ª–µ–º–µ–Ω—Ç –ø–æ–∑–∞ –µ–∫—Ä–∞–Ω–æ–º –°–ü–†–ê–í–ê */
    .b-promo-hslider li {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      white-space: nowrap;
      transform: translateX(100%);
      opacity: 0;
      transition: transform 1200ms ease, opacity 300ms ease;
    }

    /* –ê–∫—Ç–∏–≤–Ω–∏–π —É —Ü–µ–Ω—Ç—Ä—ñ */
    .b-promo-hslider li.is-active {
      transform: translateX(0%);
      opacity: 1;
    }

    /* –í–∏—Ö—ñ–¥ –í–õ–Ü–í–û */
    .b-promo-hslider li.is-prev {
      transform: translateX(-100%);
      opacity: 0;
    }

    /* –ó–∞–≥–æ—Ç–æ–≤–∫–∞ –°–ü–†–ê–í–ê (–ø–æ–∑–∞ –µ–∫—Ä–∞–Ω–æ–º) */
    .b-promo-hslider li.is-next {
      transform: translateX(100%);
      opacity: 0;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const slider = document.querySelector('.js-promo-hslider');
      if (!slider) return;

      const items = Array.from(slider.querySelectorAll('li'));
      if (items.length === 0) return;

      // –Ø–∫—â–æ –ª–∏—à–µ –æ–¥–∏–Ω ‚Äì –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—É—î–º–æ, –±–µ–∑ –∞–Ω—ñ–º–∞—Ü—ñ—ó
      if (items.length === 1) {
        items[0].classList.add('is-active');
        return;
      }

      const DURATION = 1200;   // –º–∞—î –∑–±—ñ–≥–∞—Ç–∏—Å—è –∑ CSS transition (transform)
      const HOLD = 2400;      // –ø–∞—É–∑–∞ –º—ñ–∂ —Å–ª–∞–π–¥–∞–º–∏
      let index = 0;

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è: –ø–µ—Ä—à–∏–π –∞–∫—Ç–∏–≤–Ω–∏–π, —Ä–µ—à—Ç–∞ ‚Äì "is-next" (–≥–æ—Ç–æ–≤—ñ –°–ü–†–ê–í–ê)
      items.forEach((li, i) => {
        li.classList.remove('is-active', 'is-prev', 'is-next');
        if (i === 0) {
          li.classList.add('is-active');
        } else {
          li.classList.add('is-next'); // —Ç–µ–ø–µ—Ä —Å–ø—Ä–∞–≤–∞
        }
      });

      function resetToRightInstant(el) {
        // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –µ–ª–µ–º–µ–Ω—Ç –º–∏—Ç—Ç—î–≤–æ –°–ü–†–ê–í–ê (–±–µ–∑ –∞–Ω—ñ–º–∞—Ü—ñ—ó)
        el.style.transition = 'none';
        el.classList.remove('is-active', 'is-prev');
        el.classList.add('is-next'); // translateX(100%) - —Å–ø—Ä–∞–≤–∞
        // force reflow
        void el.offsetWidth;
        // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ transition –Ω–∞–∑–∞–¥
        el.style.transition = '';
      }

      function nextSlide() {
        const current = items[index];
        const nextIdx = (index + 1) % items.length;
        const next = items[nextIdx];

        // –ì–∞—Ä–∞–Ω—Ç—É—î–º–æ: "next" –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–π –°–ü–†–ê–í–ê
        next.classList.remove('is-active', 'is-prev');
        next.classList.add('is-next');

        // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é:
        // current: —Ü–µ–Ω—Ç—Ä (is-active) -> –í–õ–Ü–í–û (is-prev)
        // next: –°–ü–†–ê–í–ê (is-next) -> —Ü–µ–Ω—Ç—Ä (is-active)
        current.classList.remove('is-active');
        current.classList.add('is-prev');

        // –ù–µ–≤–µ–ª–∏–∫–∞ –º—ñ–∫—Ä–æ–∑–∞—Ç—Ä–∏–º–∫–∞, —â–æ–± –±—Ä–∞—É–∑–µ—Ä –∑–∞—Å—Ç–æ—Å—É–≤–∞–≤ –∫–ª–∞—Å –¥–æ current
        requestAnimationFrame(() => {
          next.classList.remove('is-next');
          next.classList.add('is-active');
        });

        // –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó transform —É current ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –π–æ–≥–æ –º–∏—Ç—Ç—î–≤–æ –°–ü–†–ê–í–ê (is-next)
        const onEnd = (e) => {
          if (e.propertyName !== 'transform') return;
          current.removeEventListener('transitionend', onEnd);
          resetToRightInstant(current);
          index = nextIdx;
        };
        current.addEventListener('transitionend', onEnd);
      }

      // –ö—Ä—É—Ç–∏–º–æ —Ü–∏–∫–ª
      setInterval(nextSlide, HOLD + DURATION);
    });
  </script>
{% endif %}

<div
  class="relative b-header__wrapper"
{% if settingsHeaderBg %}
  style="background-color: {{ settingsHeaderBg }};"
  {% endif %}>
  <div class="b-header__inner container m-responsive md:py-8 mx-auto m-{{settings.header_layout}} {% if shop.customer_accounts_enabled %} header--has-account{% endif %}">

    {% render 'menu-mobile', menuItems: settings.header_menu_1.links %}
    <!-- Mobile Left Section - Hamburger & Search -->
    <div class="b-header__mobile-left md:hidden flex items-center gap-4">
      <button class="b-header__search-toggle" @click="$store.search.open()" aria-label="Open search">
        {{ searchIcon }}
      </button>
    </div>

    <nav class="b-header__nav-left hidden md:block">
      {% assign dropdown_counter = 0 %}
      <ul class="b-header__list flex">
        {% for link in settings.header_menu_1.links %}
          {% if link.links.size > 0 and settings.is_enabled_megamenu %}
            {% assign dropdown_counter = dropdown_counter | plus: 1 %}
            {% render 'megamenu', link: link, dropdown_index: dropdown_counter, is_active: is_active %}
          {% else %}
            <li class="menu-item b-header__list-item">
              <a
                href="{{ link.url }}"
                title="{{ link.title }}"
                class="b-header__list-link"
                {% if is_active %}aria-current="page"{% endif %}
              >
                {{ link.title }}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </nav>
    <div class="b-header__logo flex w-[150px]">
      <a href="{{ routes.root_url }}" class="flex items-center no-underline">
        {% if settings.header_logo %}
          <img
            src="{{ settings.header_logo | image_url }}"
            alt="{{ shop.name }}"
            class="logo--dark"
            width="240"
            height="110"
            loading="lazy"
          >
        {% endif %}
        {% if settings.header_logo_light %}
          <img
            src="{{ settings.header_logo_light | image_url }}"
            alt="{{ shop.name }}"
            class="logo--light"
            width="240"
            height="110"
            loading="lazy"
          >
        {% endif %}
      </a>
    </div>
    {%- if settings.header_menu_2.links.size > 0 -%}
      <nav class="b-header__nav-right hidden md:block">
        <ul class="b-header__list flex">
          {% for link in settings.header_menu_2.links %}
            <li class="menu-item b-header__list-item">
              <a
                href="{{ link.url }}"
                title="{{ link.title }}"
                class="b-header__list-link text-color_1 hover:text-black-content">
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </nav>
    {%- endif -%}
    <div class="b-header__cartlogin">
      <!-- Desktop Search Only -->
      <div class="b-header_search hidden md:flex" x-data>
        <button type="button" aria-label="Open search" @click="$store.search.open()" class="cursor-pointer">
          {{ searchIcon }}
        </button>
      </div>

      {%- if shop.customer_accounts_enabled -%}
        <a
          href="{{ routes.account_login_url }}"
          class="b-header__account flex"
          x-data
          @click.prevent.stop="$store.auth.open('login')"
        >

          {{ accountIcon }}
        </a>
      {%- endif -%}

      <div class="b-header_wishlist text-[#474747]">
        {% render 'wishlisthero-header-icon.liquid' %}
      </div>

      <div class="b-header_cart" x-data>
        <span
          id="i-mini-cart"
          @click.stop="$store.cart.toggleCart()"
          class="b-header_cart-toggle text-color_1 relative cursor-pointer flex">
          <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
           <path d="M10.7972 25H21.1566C22.9748 25 24.4538 23.5209 24.4538 21.7028V11.8462C24.4538 11.5246 24.1908 11.2615 23.8692 11.2615H20.3615V10.3846C20.3615 7.96723 18.3943 6 15.9769 6C13.5595 6 11.5923 7.96723 11.5923 10.3846V11.2615H8.08462C7.76308 11.2615 7.5 11.5246 7.5 11.8462V21.7028C7.5 23.5209 8.97908 25 10.7972 25ZM12.7615 10.3846C12.7615 8.61031 14.2026 7.16923 15.9769 7.16923C17.7512 7.16923 19.1923 8.61031 19.1923 10.3846V11.2615H12.7615V10.3846ZM8.66923 12.4308H11.5923V13.8923C11.5923 14.2138 11.8554 14.4769 12.1769 14.4769C12.4985 14.4769 12.7615 14.2138 12.7615 13.8923V12.4308H19.1923V13.8923C19.1923 14.2138 19.4554 14.4769 19.7769 14.4769C20.0985 14.4769 20.3615 14.2138 20.3615 13.8923V12.4308H23.2846V21.7028C23.2846 22.8749 22.3288 23.8308 21.1566 23.8308H10.7972C9.62508 23.8308 8.66923 22.8749 8.66923 21.7028V12.4308Z" fill="currentColor"/>
          </svg>

          <span
            class="b-header__cart-count"
            x-text="$store.cart.itemsCount"
            x-show="$store.cart.itemsCount > 0"></span>
        </span>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const promoBlock = document.querySelector(".b-header__promo");
    if (!promoBlock) return;

    const desktopUl = promoBlock.querySelector(".promo-desktop");
    const mobileEl  = promoBlock.querySelector(".mobile-promo");

    // Fix: Get all nested li elements from the structure
    const items = Array.from(desktopUl.querySelectorAll("li li"))
      .map(li => li.textContent.trim())
      .filter(Boolean);

    if (!items.length) return;

    let idx = 0;
    const fadeDur = 700;   // –º–∞—î –∑–±—ñ–≥–∞—Ç–∏—Å—è –∑ duration-700 (ms)
    const pause   = 5000;  // 5 —Å–µ–∫—É–Ω–¥ –º—ñ–∂ –∑–º—ñ–Ω–∞–º–∏

    function showNext() {
      // —Ñ–µ–π–¥-–∞—É—Ç
      mobileEl.classList.add("opacity-0");

      // –º—ñ–Ω—è—î–º–æ —Ç–µ–∫—Å—Ç –ø—ñ—Å–ª—è —Ñ–µ–π–¥–∞—É—Ç—É, –ø–æ—Ç—ñ–º —Ñ–µ–π–¥-—ñ–Ω
      setTimeout(() => {
        mobileEl.textContent = items[idx];
        mobileEl.classList.remove("opacity-0");
        idx = (idx + 1) % items.length;
      }, fadeDur);
    }

    // —á–∏—Å—Ç–æ –Ω–∞ —Å—Ç–∞—Ä—Ç—ñ –ø–µ—Ä–µ–∫–æ–Ω–∞—î–º–æ—Å—å, —â–æ —Å–ø–∞–Ω –ø–æ—Ä–æ–∂–Ω—ñ–π
    mobileEl.textContent = "";

    // –ø–µ—Ä—à–∏–π –ø–æ–∫–∞–∑ —ñ —Ü–∏–∫–ª
    showNext();
    setInterval(showNext, pause);
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Add click event to all search buttons
    const searchButtons = document.querySelectorAll('.b-header__search-toggle, .b-header_search button');

    searchButtons.forEach(button => {
      button.addEventListener('click', function() {
        console.log('üîç Search button clicked');

        const header = document.querySelector('.b-header');
        const wrapper = document.querySelector('.b-header__wrapper');

        console.log('Header found:', header);
        console.log('Wrapper found:', wrapper);

        if (header) {
          header.classList.add('search-open');
          console.log('‚úÖ Added search-open class to header');
        }

        if (wrapper) {
          wrapper.classList.add('has-search-open');
          console.log('‚úÖ Added has-search-open class to wrapper');
        }
      });
    });

    // Optional: Close search when clicking outside (remove if you don't want this)
    document.addEventListener('click', function(e) {
      const isSearchButton = e.target.closest('.b-header__search-toggle') ||
        e.target.closest('.b-header_search button');

      if (!isSearchButton) {
        const header = document.querySelector('.b-header');
        const wrapper = document.querySelector('.b-header__wrapper');

        if (header) header.classList.remove('search-open');
        if (wrapper) wrapper.classList.remove('has-search-open');
      }
    });
  });
</script>
