{% comment %}
  Visit block — single grid with template areas
  Mobile:
    ┌ img1 ┬ img2 ┐
    └────── text ──────┘
  Desktop:
    ┌ img1 ┬  text ┐
    └ img1 ┴  img2 ┘
{% endcomment %}

<section
  id="visit-{{ section.id }}"
  class="w-full"
  data-anim-trigger
  style="
  {% if section.settings.bg_color %}background-color: {{ section.settings.bg_color }};{% endif %}
  {% if section.settings.bg_image != blank %}background-image:url({{ section.settings.bg_image | image_url }}); background-size:cover; background-position:center;{% endif %}
    padding-top: {{ section.settings.pad_top }}px;
    padding-bottom: {{ section.settings.pad_bottom }}px;"
>
  <div class="container">
    <div class="visit-grid-{{ section.id }}">
      {% if section.settings.image_left != blank %}
        <div class="visit-img-left"
             data-anim="scroll-slide"
             data-anim-distance="60">
          <img
            src="{{ section.settings.image_left | image_url: width: 1600 }}"
            alt="{{ section.settings.image_left_alt | escape }}"
            class="block w-full h-auto object-cover md:min-h-[900px]"
            style="border-radius: {{ section.settings.radius }}px; opacity: {{ section.settings.left_opacity | divided_by: 100.0 }};"
            loading="lazy"
          >
        </div>
      {% endif %}

      <div class="visit-text flex flex-col items-start" style="row-gap: {{ section.settings.text_gap }}px; color: {{ section.settings.text_color }};">
        {% if section.settings.title != blank %}
          <h2 class="m-0 heading-2"
              style="color: {{ section.settings.title_color }};">
            {{ section.settings.title }}
          </h2>
        {% endif %}

        {% if section.settings.text != blank %}
          <p class="m-0 mb-[16px]">
            {{ section.settings.text }}
          </p>
        {% endif %}

        {% if section.settings.btn_label != blank and section.settings.btn_url != blank %}
          <a href="{{ section.settings.btn_url }}"
             class="btn btn-light"
             style="column-gap:10px; border-color: currentColor; color: {{ section.settings.button_text_color }}; background-color: {{ section.settings.button_bg_color }};">
            {{ section.settings.btn_label }}
          </a>
        {% endif %}
      </div>

      {% if section.settings.image_right != blank %}
        <div class="visit-img-right"
             data-anim="scroll-slide"
             data-anim-distance="60"
             data-anim-dir="reverse">
          <img
            src="{{ section.settings.image_right | image_url: width: 1200 }}"
            alt="{{ section.settings.image_right_alt | escape }}"
            class="block w-full h-auto object-cover md:max-h-[516px]"
            style="border-radius: {{ section.settings.radius }}px; opacity: {{ section.settings.right_opacity | divided_by: 100.0 }};"
            loading="lazy"
          >
        </div>
      {% endif %}
    </div>
  </div>

  <style>
    #visit-{{ section.id }} .visit-grid-{{ section.id }}{
      display:grid;
      grid-template-columns: 1fr 1fr;
      grid-template-areas:
      "img1 img2"
      "text text";
      gap: 40px 16px;
      align-items: end;
    }
    #visit-{{ section.id }} .visit-img-left  { grid-area: img1; }
    #visit-{{ section.id }} .visit-img-right { grid-area: img2; }
    #visit-{{ section.id }} .visit-text      { grid-area: text; }

    @media (max-width:1024px){
      #visit-{{ section.id }} .visit-img-right {
        margin-top: 130px;
      }
      #visit-{{ section.id }} .visit-grid-{{ section.id }}{
        align-items: start;
      }
    }

    @media (min-width:1024px){
      #visit-{{ section.id }} .visit-grid-{{ section.id }}{
        grid-template-columns: 1fr 1fr;
        grid-template-areas:
        "img1 text"
        "img1 img2";
        gap: 0px 100px;
      }
    }

    @media (min-width:1024px){
      .center-grid {
        grid-template-columns: 1fr auto 1fr !important;
        grid-template-areas:
    "img1 text img2"
    "img1 text img2" !important;
        align-items: center !important;
        justify-items: center !important;
      }

      .center-button {
        justify-self: center !important;
        align-items: center !important;
      }
    }

    @media (max-width: 1023px) {
      .center-grid {
        gap: 0 !important;
      }
      #visit-{{ section.id }} .visit-text.center-button {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        text-align: center !important;
      }

      #visit-{{ section.id }} .visit-text.center-button .button {
        margin: 0 auto !important;
      }
    }

    [data-anim="scroll-slide"] {
      transform: translateY(60px);
    }

    [data-anim="scroll-slide"][data-anim-dir="reverse"] {
      transform: translateY(-60px);
    }
  </style>

  <script>
    function getAnimTrigger(element) {
      return element.hasAttribute("data-anim-trigger-self") ?
        element :
        element.closest("[data-anim-trigger]") ||
        element;
    }

    function initVisitAnimations() {
      const visitSection = document.getElementById('visit-{{ section.id }}');
      if (!visitSection || !window.gsap || !window.ScrollTrigger) {
        setTimeout(initVisitAnimations, 100);
        return;
      }

      const { gsap } = window;

      const visitText = visitSection.querySelector('.visit-text');
      const hasTitle = visitText.querySelector('h2');
      const hasText = visitText.querySelector('p');

      if (!hasTitle && !hasText) {
        visitText.classList.add('center-button');
        visitSection.querySelector('.visit-grid-{{ section.id }}').classList.add('center-grid');
      }

      visitSection.querySelectorAll('[data-anim="scroll-slide"]').forEach(element => {
        const trigger = getAnimTrigger(element);
        const distance = parseInt(element.dataset.animDistance) || 60;
        const isReverse = element.hasAttribute('data-anim-dir');

        gsap.set(element, {
          y: isReverse ? -distance : distance
        });

        gsap.to(element, {
          y: 0,
          scrollTrigger: {
            trigger: trigger,
            start: "top 85%",
            end: "bottom 40%",
            scrub: 2.5,
            invalidateOnRefresh: true
          }
        });
      });

      ScrollTrigger.refresh();
    }

    if (window.gsap && window.ScrollTrigger) {
      document.addEventListener('DOMContentLoaded', initVisitAnimations);
    } else {
      const checkGSAP = setInterval(() => {
        if (window.gsap && window.ScrollTrigger) {
          clearInterval(checkGSAP);
          document.addEventListener('DOMContentLoaded', initVisitAnimations);
        }
      }, 100);
    }
  </script>
</section>

{% schema %}
{
  "name": "Visit block",
  "tag": "section",
  "class": "section-visit-block",
  "settings": [
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#EEEEEE" },
    { "type": "image_picker", "id": "bg_image", "label": "Background image (optional)" },

    { "type": "range", "id": "pad_top", "min": 0, "max": 200, "step": 4, "unit": "px", "label": "Padding top", "default": 48 },
    { "type": "range", "id": "pad_bottom", "min": 0, "max": 200, "step": 4, "unit": "px", "label": "Padding bottom", "default": 48 },

    { "type": "range", "id": "inner_gap", "min": 8, "max": 80, "step": 4, "unit": "px", "label": "Gap between blocks", "default": 24 },
    { "type": "range", "id": "text_gap", "min": 4, "max": 48, "step": 2, "unit": "px", "label": "Gap inside text block", "default": 16 },

    { "type": "color", "id": "title_color", "label": "Title color", "default": "#1A1A1A" },
    { "type": "color", "id": "text_color", "label": "Body text color", "default": "#5B5B5B" },

    { "type": "checkbox", "id": "enable_parallax", "label": "Enable parallax on images (uses data-parallax)", "default": true },

    { "type": "range", "id": "radius", "min": 0, "max": 28, "step": 2, "unit": "px", "label": "Image border radius", "default": 16 },
    { "type": "range", "id": "left_opacity", "min": 10, "max": 100, "step": 5, "unit": "%", "label": "Left image opacity", "default": 100 },
    { "type": "range", "id": "right_opacity", "min": 10, "max": 100, "step": 5, "unit": "%", "label": "Right image opacity", "default": 100 },

    { "type": "text", "id": "title", "label": "Title", "default": "Visit us" },
    { "type": "textarea", "id": "text", "label": "Body text", "default": "A boutique café is a place where you will be prepared and served a product in its original form, revealing the correct understanding of its taste." },

    { "type": "text", "id": "btn_label", "label": "Button label", "default": "Our locations" },
    { "type": "url",  "id": "btn_url",   "label": "Button link" },
    { "type": "color","id": "button_bg_color",   "label": "Button background", "default": "#FFFFFF" },
    { "type": "color","id": "button_text_color", "label": "Button text color", "default": "#1A1A1A" },

    { "type": "image_picker", "id": "image_left",  "label": "Left image" },
    { "type": "text", "id": "image_left_alt", "label": "Left image alt" },

    { "type": "image_picker", "id": "image_right", "label": "Right image (smaller)" },
    { "type": "text", "id": "image_right_alt", "label": "Right image alt" }
  ],
  "presets": [
    { "name": "Visit block", "category": "Sections" }
  ]
}
{% endschema %}
