{"version":3,"file":"main-product-DyTyat1O.js","sources":["../frontend/scripts/sections/main-product.js"],"sourcesContent":["document.addEventListener('alpine:init', () => {\n  Alpine.data('productCard', (sectionId, product) => ({\n    sectionId,\n    mainProduct: product || {},\n    mode: null, // one-time | subscribe\n    showSubscription: false,\n    discount: 0,\n    regularPrice: 0,\n    discountedPrice: 0,\n    actualPrice: 0,\n    isLoading: false,\n    sellingPlanGroups: undefined,\n    sellingPlanId: null,\n    sellingPlansMap: [],\n    selectedPlanId: null,\n    selectedPlan: {},\n    selectedProduct: null,\n    quantity: 1,\n\n    init() {\n      if (!this.mainProduct || !this.mainProduct.price) {\n        console.error('mainProduct or its price is missing');\n        return;\n      }\n\n      const tabElement = this.$el.querySelector('.tabs-product-selector');\n      this.sellingPlanGroups = this.mainProduct.selling_plan_groups;\n\n      if (this.sellingPlanGroups?.length > 0) {\n        const firstGroup = this.sellingPlanGroups[0];\n        if (firstGroup?.selling_plans?.length > 0) {\n          this.sellingPlanId = firstGroup.app_id;\n          this.sellingPlansMap = firstGroup.selling_plans;\n          this.selectedPlanId = this.sellingPlansMap[0].id;\n          this.selectedPlan = this.sellingPlansMap.find((plan) => plan.id === this.selectedPlanId);\n          this.discount = this.selectedPlan.price_adjustments[0].value;\n        }\n      }\n      // console.log('Selling plan:', this.mainProduct);\n      // console.log('Selling plan:', this.sellingPlanGroups[0]);\n      // console.log('Selling plan:', this.sellingPlansMap);\n      // console.log('Selling plan:', this.selectedPlan);\n\n      if (tabElement) {\n        this.tab1Selected = JSON.parse(tabElement.getAttribute('data-tab1-selected'));\n        this.tab2Selected = JSON.parse(tabElement.getAttribute('data-tab2-selected'));\n        this.mode = tabElement.getAttribute('data-tab-selected');\n      }\n\n      this.showSubscription = this.mode === 'subscribe';\n      this.updateActualPrice();\n    },\n\n    initNewProduct(product) {\n      this.mainProduct = product;\n      // this.updateActualPrice();\n      this.$nextTick(() => {\n        console.log('Product initialized:', this.mainProduct);\n        this.updateActualPrice();\n      });\n    },\n\n    formatPrice(price) {\n      const formattedPrice = price.toFixed(2);\n      return `$${formattedPrice}`;\n    },\n\n    updateActualPrice() {\n      this.regularPrice = this.mainProduct.price / 100;\n      if (this.mode === 'subscribe' && this.discount > 0) {\n        this.discountedPrice = this.regularPrice - (this.regularPrice * this.discount / 100);\n        this.actualPrice = this.discountedPrice;\n        // console.log('this.actualPrice:', this.actualPrice);\n      } else {\n        this.actualPrice = this.regularPrice;\n      }\n    },\n\n    switchTab(tab) {\n      this.mode = tab;\n      this.showSubscription = (tab === 'subscribe');\n      this.updateActualPrice();\n    },\n\n    addToCartPDP(quantity) {\n      const variantId = this.$el.getAttribute('data-first-variant');\n      const product = {\n        variantId,\n        quantity,\n        sellingPlanId: this.selectedPlanId,\n        properties: {},\n      };\n      Alpine.store('cart').addToCart(product);\n      this.quantity = 1;\n    },\n\n    loadProduct(productHandle) {\n      const url = `/products/${productHandle}?sections=${this.sectionId}`;\n      const productUrl = `/products/${productHandle}.js`\n\n      fetch(url)\n        .then((response) => {\n          if (!response.ok) {\n            throw new Error('Network response was not ok');\n          }\n          console.log('Product details:', response);\n          return response.json();\n        })\n        .then((product) => {\n          if (!product[this.sectionId]) {\n            console.error('Product section not found');\n            return;\n          }\n          const container = document.createElement('div');\n          container.innerHTML = product[this.sectionId];\n          const productDetails = container.querySelector('#MainProduct-' + this.sectionId);\n          if (this.$refs.productCardRef) {\n            this.$refs.productCardRef.replaceWith(productDetails);\n          } else {\n            console.error('Reference to productCardRef not found');\n          }\n          return fetch(productUrl);\n        })\n        .then((response) => {\n          if (!response.ok) {\n            throw new Error('Failed to fetch product data');\n          }\n          return response.json();\n        })\n        .then((productData) => {\n          // this.mainProduct = productData;\n          // this.init();\n          // this.updateActualPrice();\n          this.initNewProduct(productData);\n          window.history.pushState({ urlPath: productHandle }, '', productHandle);\n        })\n        .catch((error) => {\n          console.error('Error loading product:', error);\n        });\n      }\n  }));\n});\n"],"names":["sectionId","product","_a","_b","tabElement","firstGroup","plan","price","tab","quantity","productHandle","url","productUrl","response","container","productDetails","productData","error"],"mappings":"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"}