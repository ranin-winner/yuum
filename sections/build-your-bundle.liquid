{% comment %}
  Build Your Bundle – hero
  - Tailwind first
  - Mobile-first layout; desktop → дві колонки
  - Badge with bird positioned absolutely
{% endcomment %}
{% render 'entry' with '@/styles/sections/build-your-bundle.scss' %}

<section
  id="build-your-bundle-{{ section.id }}"
  class="pt-[40px] md:pt-[60px] build-bundle relative overflow-hidden {{ section.settings.bg_color }} {{ section.settings.additional_classes }}"
>
  {%- assign pad_y_mobile = section.settings.padding_y_mobile | default: 40 -%}
  {%- assign pad_y_desktop = section.settings.padding_y_desktop | default: 80 -%}

  <div class="container mx-auto px-4 md:px-6 py-[{{ pad_y_mobile }}px] md:py-[{{ pad_y_desktop }}px]">
    <div class="flex flex-col md:flex-row items-start">

      <div class="flex-1 relative w-full">
        {%- comment -%} optional decorative bg image (desktop/mobile) {%- endcomment -%}
        {% if section.settings.bg_image_desktop or section.settings.bg_image_mobile %}
          <picture aria-hidden="true" class="pointer-events-none select-none block">
            {% if section.settings.bg_image_mobile != blank %}
              <source media="(max-width: 767px)" srcset="{{ section.settings.bg_image_mobile | image_url: width: 768 }}">
            {% endif %}
            {% if section.settings.bg_image_desktop != blank %}
              <img
                src="{{ section.settings.bg_image_desktop | image_url: width: 1200 }}"
                alt=""
                class="w-full h-auto object-contain opacity-100"
                loading="lazy">
            {% endif %}
          </picture>
        {% endif %}

        {%- comment -%} Main phone mockup {%- endcomment -%}
        {% if section.settings.phone_image_desktop or section.settings.phone_image_mobile %}
          <div class="flex items-center justify-center md:flex-none">
            <picture>
              {% if section.settings.phone_image_mobile != blank %}
                <source media="(max-width: 767px)" srcset="{{ section.settings.phone_image_mobile | image_url: width: 600 }}">
              {% endif %}
              <img
                src="{{ section.settings.phone_image_desktop | default: section.settings.phone_image_mobile | image_url: width: 900 }}"
                alt="{{ section.settings.phone_image_alt | escape }}"
                class="mx-auto w-full h-auto"
                loading="lazy">
            </picture>
          </div>
        {% endif %}

        {%- comment -%} Secondary image (box / mochi) {%- endcomment -%}
        {% if section.settings.side_image %}
          <img
            src="{{ section.settings.side_image | image_url: width: 800 }}"
            alt="{{ section.settings.side_image_alt | escape }}"
            class="hidden md:block absolute -left-6 bottom-0 w-[260px] h-auto"
            loading="lazy">
        {% endif %}
      </div>

      <div class="flex-1 build-bundle__text md:ml-[-20px]">
        {%- if section.settings.show_badge -%}
          <div class="inline-block relative mb-6">
            {% if section.settings.bird_image %}
              {%- assign bird_x_d = section.settings.bird_offset_x_desktop | default: 28 -%}
              {%- assign bird_y_d = section.settings.bird_offset_y_desktop | default: -28 -%}
              {%- assign bird_x_m = section.settings.bird_offset_x_mobile | default: 14 -%}
              {%- assign bird_y_m = section.settings.bird_offset_y_mobile | default: -14 -%}
              <img
                src="{{ section.settings.bird_image | image_url: width: 300 }}"
                alt="{{ section.settings.bird_alt | escape }}"
                class="bundle-bird w-[80px] md:w-[100px] mb-[-9px] md:mr-[0px] md:mb-[-13px] md:mr-[-5px]"
                style="left: {{ bird_x_m }}px; top: {{ bird_y_m }}px; "
                data-bird-desktop-left="{{ bird_x_d }}"
                data-bird-desktop-top="{{ bird_y_d }}">
            {% endif %}

            <span class="bundle-badge inline-flex items-center rounded-full bg-white/90 text-[#111] text-[13px] md:text-[16px] md:leading-[22px] leading-[16px] py-[9px] px-[16px]">
              {{ section.settings.badge_text | default: 'New' }}
            </span>
          </div>
        {%- endif -%}

        {% if section.settings.kicker != blank %}
          <p class="text-sm uppercase tracking-[0.2em] opacity-80 mb-2">{{ section.settings.kicker | escape }}</p>
        {% endif %}

        {% if section.settings.title != blank %}
          <h2 class="build-bundle__title heading-3 text-white">
            {{ section.settings.title }}
          </h2>
        {% endif %}

        {% if section.settings.text != blank %}
          <p class="mt-[12px] mb-[24px] text-white/85 text-[18px] md:text-[24px] max-w-[44ch] font-normal">
            {{ section.settings.text }}
          </p>
        {% endif %}

        {%- if section.blocks.size > 0 -%}
          <ul class="mt-6 space-y-2 md:flex-row flex-col flex justify-between md:items-center gap-[16px] md:gap-[24px] md:max-w-[500px]">
            {%- for block in section.blocks -%}
              {%- if block.type == 'feature' -%}
                <li {{ block.shopify_attributes }} class="text-white/90 font-normal text-[18px] md:text-[24px] flex items-start gap-2">
                  {% if block.settings.icon != blank %}
                    <img src="{{ block.settings.icon | image_url: width: 40 }}" alt="" class="w-4 h-4 mt-[2px]" loading="lazy">
                  {% endif %}
                  <span>{{ block.settings.text }}</span>
                </li>
              {%- endif -%}
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {% if section.settings.btn_label != blank %}
          <div class="mt-8">
            <a href="{{ section.settings.btn_link | default: '#' }}"
               class="btn btn-light btn-light-no-border !font-normal">
              {{ section.settings.btn_label }}
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="pointer-events-none absolute inset-0 -z-[1] {{ section.settings.bg_tint }}"></div>
</section>

<style>
    .build-bundle .bundle-badge {
        backdrop-filter: saturate(180%) blur(2px);
    }
</style>

<script>
  // move bird for desktop offsets (inline style different for mobile)
  document.addEventListener('DOMContentLoaded', () => {
    const wrap = document.getElementById('build-your-bundle-{{ section.id }}');
    const bird = wrap?.querySelector('.bundle-bird');
    if (!bird) return;

    const mq = window.matchMedia('(min-width: 768px)');
    const apply = () => {
      if (mq.matches) {
        bird.style.left = (bird.dataset.birdDesktopLeft || 28) + 'px';
        bird.style.top  = (bird.dataset.birdDesktopTop  || -28) + 'px';
      } else {
        // mobile styles already inline from Liquid
      }
    };
    apply();
    mq.addEventListener?.('change', apply);
  });
</script>

{% schema %}
{
  "name": "Build Your Bundle",
  "settings": [
    { "type": "text", "id": "additional_classes", "label": "Extra classes", "default": "bg-[#9B9B9D]" },

    { "type": "header", "content": "Layout & padding" },
    { "type": "range", "id": "padding_y_mobile", "label": "Padding Y (mobile, px)", "min": 0, "max": 200, "step": 2, "default": 40 },
    { "type": "range", "id": "padding_y_desktop", "label": "Padding Y (desktop, px)", "min": 0, "max": 240, "step": 4, "default": 96 },

    { "type": "header", "content": "Background" },
    { "type": "text", "id": "bg_color", "label": "Background Tailwind class", "default": "bg-[#9B9B9D]" },
    { "type": "text", "id": "bg_tint", "label": "Tint overlay classes (optional)" },
    { "type": "image_picker", "id": "bg_image_desktop", "label": "Left composition image (desktop)" },
    { "type": "image_picker", "id": "bg_image_mobile", "label": "Left composition image (mobile)" },

    { "type": "header", "content": "Main imagery" },
    { "type": "image_picker", "id": "phone_image_desktop", "label": "Phone image (desktop)" },
    { "type": "image_picker", "id": "phone_image_mobile", "label": "Phone image (mobile)" },
    { "type": "text", "id": "phone_image_alt", "label": "Phone image alt", "default": "Build your own bundle – preview" },
    { "type": "image_picker", "id": "side_image", "label": "Secondary image (box/mochi, desktop only)" },
    { "type": "text", "id": "side_image_alt", "label": "Secondary image alt", "default": "Product box" },

    { "type": "header", "content": "Badge + Bird" },
    { "type": "checkbox", "id": "show_badge", "label": "Show badge", "default": true },
    { "type": "text", "id": "badge_text", "label": "Badge text", "default": "New" },
    { "type": "image_picker", "id": "bird_image", "label": "Bird image" },
    { "type": "text", "id": "bird_alt", "label": "Bird alt", "default": "Decorative bird" },
    { "type": "range", "id": "bird_width_mobile", "label": "Bird width (mobile, px)", "min": 20, "max": 220, "step": 2, "default": 80 },
    { "type": "range", "id": "bird_width_desktop", "label": "Bird width (desktop, px)", "min": 40, "max": 320, "step": 4, "default": 140 },

    { "type": "paragraph", "content": "Offsets use ≤101 steps rule. Negative values allowed." },
    { "type": "range", "id": "bird_offset_x_mobile", "label": "Bird X (mobile, px)", "min": -100, "max": 100, "step": 2, "default": 14 },
    { "type": "range", "id": "bird_offset_y_mobile", "label": "Bird Y (mobile, px)", "min": -100, "max": 100, "step": 2, "default": -14 },
    { "type": "range", "id": "bird_offset_x_desktop", "label": "Bird X (desktop, px)", "min": -100, "max": 100, "step": 2, "default": 28 },
    { "type": "range", "id": "bird_offset_y_desktop", "label": "Bird Y (desktop, px)", "min": -100, "max": 100, "step": 2, "default": -28 },

    { "type": "header", "content": "Texts" },
    { "type": "text", "id": "kicker", "label": "Kicker (small uppercase)" },
    { "type": "text", "id": "title", "label": "Title", "default": "Build your own bundle" },
    { "type": "textarea", "id": "text", "label": "Paragraph", "default": "Create a completely individual its.box set and combine products from all collections to your liking!" },

    { "type": "header", "content": "Button" },
    { "type": "text", "id": "btn_label", "label": "Button label", "default": "Build bundle" },
    { "type": "url", "id": "btn_link", "label": "Button link" }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature line",
      "settings": [
        { "type": "image_picker", "id": "icon", "label": "Icon (optional)" },
        { "type": "text", "id": "text", "label": "Text", "default": "Free delivery over £50" }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    { "name": "Build Your Bundle", "category": "Hero" }
  ]
}
{% endschema %}
