{"version":3,"file":"main-product-CrbXoggx.js","sources":["../frontend/scripts/sections/main-product.js"],"sourcesContent":["document.addEventListener('alpine:init', () => {\r\n    Alpine.data('productCard', (sectionId, product) => ({\r\n  \r\n      // ---------- STATE ----------\r\n      sectionId,\r\n      mainProduct: product || {},\r\n  \r\n      mode: 'one-time',\r\n      showSubscription: false,\r\n  \r\n      discount: 0,\r\n      regularPrice: 0,\r\n      discountedPrice: 0,\r\n      actualPrice: 0,\r\n  \r\n      sellingPlanGroups: undefined,\r\n      sellingPlanId: null,\r\n      sellingPlansMap: [],\r\n      selectedPlanId: null,\r\n      selectedPlan: {},\r\n  \r\n      isLoading: false,\r\n      sliderLoading: false,\r\n      swiper: null,\r\n  \r\n      // ---------- LIFECYCLE ----------\r\n      init() {\r\n        try { this.bootstrapModeFromDOM(); } catch(e) { /* noop */ }\r\n        try { this.updateActualPrice(); } catch(e) { /* noop */ }\r\n  \r\n        // важливо інітити після першого рендера\r\n        this.$nextTick(() => this.initProductSwiper());\r\n      },\r\n  \r\n      destroy() {\r\n        this.destroyProductSwiper();\r\n      },\r\n  \r\n      // ---------- HELPERS ----------\r\n      // Працюємо тільки всередині поточного Alpine-компонента\r\n      $q(selector) { return this.$root ? this.$root.querySelector(selector) : null; }\r\n      ,\r\n  \r\n      getSliderWrapper() {\r\n        return this.$q('[data-role=\"main-product-slider\"]');\r\n      },\r\n  \r\n      // ---------- SWIPER ----------\r\n      initProductSwiper() {\r\n        try {\r\n          this.destroyProductSwiper();\r\n  \r\n          const wrapper = this.getSliderWrapper();\r\n          if (!wrapper) return;\r\n          if (!window.Swiper) { console.error('[productCard] Swiper is not available'); return; }\r\n  \r\n          const container  = wrapper.querySelector('[data-el=\"container\"]');\r\n          const nextEl     = wrapper.querySelector('[data-el=\"next\"]');\r\n          const prevEl     = wrapper.querySelector('[data-el=\"prev\"]');\r\n          const pagination = wrapper.querySelector('[data-el=\"pagination\"]');\r\n  \r\n          if (!container) return;\r\n  \r\n          // Підтримка і старої, і нової розмітки (на всяк випадок)\r\n          // Якщо контейнер має клас .swiper-container — додамо .swiper для стилів Swiper v8+\r\n          if (container.classList.contains('swiper-container')) {\r\n            container.classList.add('swiper');\r\n          }\r\n  \r\n          this.swiper = new window.Swiper(container, {\r\n            slidesPerView: 1,\r\n            spaceBetween: 0,\r\n            loop: false,\r\n            watchOverflow: true,\r\n  \r\n            navigation: { nextEl, prevEl },\r\n            pagination: { el: pagination, clickable: true },\r\n  \r\n            observer: true,\r\n            observeParents: true,\r\n          });\r\n        } catch (e) {\r\n          console.error('[productCard] initProductSwiper failed:', e);\r\n        }\r\n      },\r\n  \r\n      destroyProductSwiper() {\r\n        try {\r\n          if (this.swiper && typeof this.swiper.destroy === 'function') {\r\n            this.swiper.destroy(true, true);\r\n          }\r\n        } finally {\r\n          this.swiper = null;\r\n        }\r\n      },\r\n  \r\n      // ---------- AJAX ПІДМІНА СЕКЦІЇ ----------\r\n      loadProduct(productHandle) {\r\n        if (!productHandle) return;\r\n  \r\n        const sectionUrl = `/products/${productHandle}?sections=${this.sectionId}`;\r\n        const jsonUrl    = `/products/${productHandle}.js`;\r\n  \r\n        this.isLoading = true;\r\n  \r\n        fetch(sectionUrl)\r\n          .then((r) => { if (!r.ok) throw new Error('[productCard] Section fetch failed'); return r.json(); })\r\n          .then((payload) => {\r\n            const html = payload?.[this.sectionId];\r\n            if (!html) throw new Error('[productCard] Section HTML not found');\r\n  \r\n            const tmp = document.createElement('div');\r\n            tmp.innerHTML = html;\r\n  \r\n            // Важливо: знайди новий корінь секції саме всередині $root-контексту\r\n            const fresh = tmp.querySelector('#MainProduct-' + this.sectionId);\r\n            if (fresh && this.$refs.productCardRef) {\r\n              this.$refs.productCardRef.replaceWith(fresh);\r\n              // Оновлюємо $root посилання на новий DOM вузол\r\n              this.$root = fresh;\r\n              this.$nextTick(() => this.initProductSwiper());\r\n            }\r\n  \r\n            return fetch(jsonUrl);\r\n          })\r\n          .then((r) => { if (!r?.ok) throw new Error('[productCard] Product JSON fetch failed'); return r.json(); })\r\n          .then((productData) => {\r\n            this.initNewProduct(productData);\r\n            window.history.pushState({ urlPath: productHandle }, '', productHandle);\r\n          })\r\n          .catch((e) => console.error(e))\r\n          .finally(() => { this.isLoading = false; });\r\n      },\r\n  \r\n      initNewProduct(productData) {\r\n        if (!productData || !productData.id) return;\r\n        this.mainProduct = productData;\r\n        this.updateActualPrice();\r\n        this.$nextTick(() => this.initProductSwiper());\r\n      },\r\n  \r\n      // ---------- ВАРІАНТИ/ЦІНИ ----------\r\n      updateActualPrice() {\r\n        const variant = this.getSelectedVariant();\r\n        if (!variant) return;\r\n  \r\n        this.regularPrice    = Number(variant.compare_at_price || variant.price || 0);\r\n        this.discountedPrice = Number(variant.price || 0);\r\n  \r\n        if (this.showSubscription && this.selectedPlan && this.selectedPlan.discount) {\r\n          const pct = Number(this.selectedPlan.discount) || 0;\r\n          this.actualPrice = Math.round(this.discountedPrice * (1 - pct / 100));\r\n        } else {\r\n          this.actualPrice = this.discountedPrice;\r\n        }\r\n      },\r\n  \r\n      getSelectedVariant() {\r\n        const variants = this.mainProduct?.variants || [];\r\n        if (!variants.length) return null;\r\n  \r\n        const input = document.querySelector(\r\n          '[name=\"id\"][type=\"hidden\"], [name=\"id\"][type=\"radio\"]:checked'\r\n        );\r\n        if (input && input.value) {\r\n          const found = variants.find(v => String(v.id) === String(input.value));\r\n          if (found) return found;\r\n        }\r\n        const fav = variants.find(v => v.available);\r\n        return fav || variants[0];\r\n      },\r\n  \r\n      onVariantChange() {\r\n        try { this.updateActualPrice(); } catch(e) { /* noop */ }\r\n      },\r\n  \r\n      // ---------- ПІДПИСКА ----------\r\n      bootstrapModeFromDOM() {\r\n        const el = document.querySelector('[data-subscription-tabs]');\r\n        if (!el) { this.mode = 'one-time'; this.showSubscription = false; return; }\r\n  \r\n        const t1 = el.getAttribute('data-tab1-selected');\r\n        const t2 = el.getAttribute('data-tab2-selected');\r\n        const m  = el.getAttribute('data-tab-selected');\r\n  \r\n        if (t1 != null) this.tab1Selected = JSON.parse(t1);\r\n        if (t2 != null) this.tab2Selected = JSON.parse(t2);\r\n        if (m) this.mode = m;\r\n  \r\n        this.showSubscription = this.mode === 'subscribe';\r\n      },\r\n  \r\n      selectPlan(planId) {\r\n        this.selectedPlanId = planId || null;\r\n        this.selectedPlan = (this.sellingPlansMap || []).find(p => String(p.id) === String(planId)) || {};\r\n        this.showSubscription = !!this.selectedPlanId;\r\n        this.updateActualPrice();\r\n      },\r\n  \r\n      toggleSubscription(force) {\r\n        if (typeof force === 'boolean') this.showSubscription = force;\r\n        else this.showSubscription = !this.showSubscription;\r\n        this.updateActualPrice();\r\n      },\r\n    }));\r\n  });\r\n  "],"names":["sectionId","product","selector","wrapper","container","nextEl","prevEl","pagination","e","productHandle","sectionUrl","jsonUrl","r","payload","html","tmp","fresh","productData","variant","pct","_a","variants","input","found","v","el","t1","t2","m","planId","p","force"],"mappings":"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"}